# Проектная работа "Веб-ларек"
ссылка на репозиторий: https://github.com/tatasenochek/web-larek-frontend.git

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении

Главная страница
```
export interface IAppMain {
  basket: number;
  cardsList: ICard[];
  preview: string | null;
}
```

Товар
```
export interface ICard {
  _id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

Данные заказа
```
export interface IOrder {
  payment: boolean;
  address: string;
  email: string;
  phone: string;
}
```

Корзина
```
export interface IBasket {
  quantity: number;
  title: string;
  price: number;
  totalPrice: number;
}
```

Ошибки полей формы 
```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Данные корзины, которые отображаются на главной странице
```
export type TBasketPablicInfo = Pick<IBasket, 'quantity'>;
```

Данные товара, которые отображаются на главной странице
```
export type TCardPablicInfo = Pick<ICard, '_id' | 'image' | 'title' | 'category' | 'price'>;
```

Данные товара, которые отображаются в модальном окно карточки
```
export type TCardInfo = Pick<ICard, '_id' | 'description' | 'image' | 'title' | 'category' | 'price'>;
```

Данные товара, которые отображаются модальном окне корзины
```
export type TBasketInfo = Pick<IBasket, 'title' | 'price' | 'totalPrice'>;
```

Данные пользователя, которые  можно редактировать в модальном окне оформления заказа
```
export type TUserCheckout = Pick<IOrder, 'payment' | 'address' | 'email' | 'phone'>;
```

Данные товара, которые отображаются в модальном окне успешного завершения заказа
```
export type TUserCheckoutComplieted = Pick<IBasket, 'totalPrice'>;
```

## Архитектура приложения

Код приложения WEB-ларёк разделен на:
- слой отображения (все что отвечает за вывод информации пользователю);
- слой данных (вся логика приложения без интерфейса);
- presenter (связывает данные и отобрадение);

### Базовый код

#### Класс API
Класс API предоставляет базовую функциональность для работы с API.

##### Свойства:
- readonly baseUrl: string - неизменяемое свойство, URL основного API;
- protected options: RequestInit - защищенное свойство, дополнительные параметры для HTTP-запросов;
##### Конструктор:
- baseUrl: string - URL основного API; 
- options: RequestInit = {} - дополнительные параметры для HTTP-запросов;
##### Методы:
- protected handleResponse(response: Response): Promise<object> - защищеный метод, обрабатывает полученный ответ от сервера. Если ответ положительный (response.ok), он возвращает содержимое ответа в виде JSON. В противном случае, он возвращает содержимое ошибки из JSON-ответа;
- get(uri: string) - отправляет запрос с данными и возвращает ответ сервера в виде промиса с объектом;
- post(uri: string, data: object, method: ApiPostMethods = 'POST') - принимает объект с данными, обрабатывает и отправляет их как параметр при вызове метода;

#### Класс EventEmitter
Брокер событий используется в presenter для обработки событий и в слоях приложения для генерации событий.

##### Свойства:
- _events: Map - хранит карту событий и их подписчиков;
##### Конструктор:
- constructor() - создает _events, представляющую собой карту событий;
##### Методы:
- on() - устанавливает обработчик для указанного события;
- off() - удаляет обработчик для указанного события;
- emit() - инициирует событие с указанными данными;
- onAll() - устанавливает обработчик для всех событий;
- offAll() - удаляет все обработчики событий;
- trigger() - создает функцию-триггер, которая инициирует указанное событие при вызове;

#### Класс Component
Абстрактный класс, предоставляет базовую функциональность для создания дочерних компонентов

##### Конструктор:
- constructor(container: HTMLElement) - контейнер, который является корневым DOM-элементом, в который будет вставлен компонент.
##### Методы:
- toggleClass(element: HTMLElement, className: string, force?: boolean) - переключает класс элемента;
- protected setText(element: HTMLElement, value: unknown) - устанавливает текстовое содержимое;
- setDisabled(element: HTMLElement, state: boolean) - устанавливает состояние блокировки;
- protected setHidden(element: HTMLElement) - скрывает элемент;
- protected setVisible(element: HTMLElement) - показывает элемент;
- protected setImage(element: HTMLImageElement, src: string, alt?: string) - установить изображение с алтернативным текстом;
- render(data?: Partial<T>): HTMLElement - возвращает DOM-элемент;

#### Класс Model
Абстрактный класс, представляет собой базовую модель данных.

##### Конструктор:
- constructor(data: Partial<T>, protected events: IEvents) - конструктор принимает данные модели и объект событий, копирует данные в модель.
##### Методы:
- emitChanges(event: string, payload?: object) - уведомляет о изменении модели;


### Слой данных

#### Класс AppData
Расширяет класс Model. Отвечает за умправлением состояния приложения, храниение данных и выполнение операций.

##### Свойства:
- catalog: ICard[] - данные о товаре;
- basket: ICard[] = [] - данные о товаре в корзине;
- order: IOrder = {} - данные о заказе;
- preview: string | null - идентификационный номер товара;
- formErrors: FormErrors = {} - ошибки полей формы;
##### Конструктор:
- constructor() - конструктор наследуется от класса Model
##### Методы:
- addBasket() - добавляет выбранный товар в корзину;
- clearBasket() - очищает корзину товаров;
- getTotal() - возвращает общую стоимость выбранных товаров;
- setCatalog() - устанавливает каталог товаров;
- setPreview() - устанавливает предпросмотр товара;
- setOrderField() - устанавливает значение поля в форме заказа;
- removeBasket() - удаляет товар из корзины;
- updateBasket() - обновляет состояние корзины;
- validateOrder() - проверяет корректность данных в форме заказа;
- resetFormData() - очищает данные формы заказа;

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элементн) передаваемых данных.

#### Класс Modal
Расширяет класс Component, предназначен для реализации модального окна. Так же предоставляет методы `open` и `close`для управления отображением модального окна.
##### Свойства:
- protected _closeButton: HTMLButtonElement - кнопка закрытия модального окна.;
- protected _content: HTMLElement - контент модального окна;
##### Конструктор:
- constructor(selector: string, events: IEvents) - конструктор принимает селектор по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициализации событий.
##### Методы:
- set content(value: HTMLElement) - устанавливает новый контент для модального окна;
- open() - открывает модальное окно;
- close() - закрывает модальное окно;
- render(data: IModalData): HTMLElement - рендерит модальное окно с переданным контентом и открывает его;

#### Класс Form
Расширяет класс Component, предназначен для реализации модального окна с формой ввода данных пользователя.

##### Свойства:
- protected _submit: HTMLButtonElement - кнопка отправки формы;
- protected _errors: HTMLElement - элемент для отображения ошибок ввода;
##### Конструктор:
- constructor(protected container: HTMLFormElement, protected events: IEvents) - принимает контейнер с элементами формы, объект событий, используемый для всех полей ввода и кнопки отправки формы;
##### Методы:
- protected onInputChange(field: keyof T, value: string) - вызывается при изменении значения поля ввода и отправляет событие с измененным значением;
- set valid(value: boolean) - устанавливает состояние валидности формы. Если форма не валидна, кнопка отправки формы становится неактивной;
- set errors(value: string) - устанавливает текст ошибок ввода в элемент _errors;
- render(state: Partial<T> & IFormState) - рендерит форму с переданными данными и состоянием валидности;

#### Класс Basket
Расширяет класс Component, предназначен для реализации модального окна корзины покупок.

##### Свойства:
- protected _list: HTMLElement - элемент, содержащий список товаров в корзине;
- protected _total: HTMLElement - элемент, отображающий общую стоимость товаров в корзине;
- protected _button: HTMLElement - элемент, представляющий кнопку действия (например, "Оформить заказ");
##### Конструктор:
- constructor(container: HTMLElement, protected events: EventEmitter) - принимает корневой элемент для корзины и объект событий;
##### Методы:
- set items(items: HTMLElement[]) - устанавливает список товаров в корзине. Если список пуст, вместо него отображается сообщение "Корзина пуста";
- set selected(items: string[]) - устанавливает выбранные товары. Если товары выбраны, кнопка действия становится активной, иначе - неактивной;
- set total(total: number) - устанавливает общую стоимость товаров в корзине;

#### Класс Success
Расширяет класс Component, предназначен для реализации модального окна успешного офомления заказа.

##### Свойства:
- protected _close: HTMLElement - элемент, представляющий кнопку закрытия;
##### Конструктор:
- constructor(container: HTMLElement, actions: ISuccessActions) - принимает элемент успешной оплаты и устанавливает обработчик события для кнопки закрытия;
##### Методы:
- set result(text: string) - устанавливает сообщение об успешной оплате
- set total(total: number) - устанавливает общую стоимость товаров в корзине;

#### Класс Order
Расширяет класс Form, предназначен для реализации модального окна заказа товара.

##### Свойства:
- _offlinePay:HTMLElement - элемент, представляющий кнопку оплаты при получении;
- _onlinePay:HTMLElement - элемент, представляющий кнопку оплаты онлайн;
##### Конструктор:
-  constructor(container: HTMLFormElement, events: IEvents) - принимает элементы способа оплаты, форму доставки и контактных данных пользователя, объект событий;
##### Методы:
- set payment(value: boolean) - выбор сособа оплаты;
- set address(value: string) - устанавливает адресс пользователя;
- set email(value: string) - устанавливает электронную почту пользователя;
- set phone(value: string) - устанавливает номер телефона пользователя;

#### Класс Page
Расширяет класс Component, предназначен для управления содержимым страницы и предоставляет механизмы для отображения списка товаров и корзины.
##### Свойства:
- protected _counter: HTMLElement - элемент, представляющий счетчик товаров в корзине;
- protected _catalog: HTMLElement - элемент, представляющий каталог товаров;
- protected _wrapper: HTMLElement - элемент, представляющий обертку страницы;
- protected _basket: HTMLElement - элемент, представляющий кнопку корзины товаров;
##### Конструктор:
- constructor(container: HTMLElement, protected events: IEvents) - принимает корневой элемент для компонента и объект событий. В конструкторе устанавливается обработчик события для элемента корзины, который открывает окно выбранными товарами;
##### Методы:
- set counter(value: number) - устанавливает количество товаров в корзине;
- set catalog(items: HTMLElement[]) - устанавливает список товаров;
- set locked(value: boolean) - устанавливает состояние блокировки страницы;

#### Класс Card
Расширяет класс Component, предназначен для отображения и управления карточками товара.

##### Свойства:
- _category - элемент, представляющий категорию товара;
- _title - элемент, представляющий название товара;
- _description - элемент, представляющий описание товара;
- _image - элемент, представляющий изображение товар;
- _button - элемент, представляющий кнопку карточки;
- _price - элемент, представляющий цену товара;
##### Конструктор:
- constructor(container: HTMLElement, actions?: ICardActions) - принимает контейнер для карточки и объект действий. В конструкторе устанавливаются обработчики событий для категории, заголовка, изображения, описания, кнопки, цены.
##### Методы:
- set id(value: string) - устанавливает идентификатор товара;
- set category(value: string) - устанавливает категорию товара и добавляет соответствующий класс к элементу категории;
- set title(value: string) - устанавливает название товара;
- set description(value: string) - устанавливает описание карточки;
- set image(value: string) - устанавливает изображение карточки;
- set price(value: number | null) - устанавливает цену карточки и, если цена установлена, отключает кнопку карточки;
- inBasket(value: boolean) - устанавливает, находится ли карточка в корзине, и, если нет, отключает кнопку карточки.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

### Описание событий

- `modal:open` - открытие модальных окон;
- `modal:close` - закрытие модальных окон;
- `card:add` - добавление товара в корзину;
- `card:delete` - удаление ранее выбранного товара из корзины;
- `basket:delete` - удаление ранее выбранного товара из корзины;
- `basket:submit` - сохранение выбранных товаров;
- `order:changed` - изменение данных в форме с данными пользователя;
- `order:validation` - событие, сообщающее о необходимости валидации формы данных пользователя;
- `order:complet` - событие, сообщающее об успешном оформлени заказа;
