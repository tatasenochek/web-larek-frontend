# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении

Товар
```
export interface ICard {
  _id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number;
}
```

Данные пользователя
```
export interface IUser {
  payment: boolean;
  address: string;
  email: string;
  phone: number;
}
```

Корзина
```
export interface IBasket {
  quantity: number;
  title: string;
  price: number;
  totalPrice: number;
}
```

Интерфейс для модели данных
```
export interface ICardsData {
  cards: ICard[];
  preview: string | null;
}
```
Данные корзины, которые отображаются на главной странице
```
export type TBasketPablicInfo = Pick<IBasket, 'quantity'>;
```

Данные товара, которые отображаются на главной странице
```
export type TCardPablicInfo = Pick<ICard, '_id' | 'image' | 'title' | 'category' | 'price'>;
```

Данные товара, которые отображаются в модальном окно карточки
```
export type TCardInfo = Pick<ICard, '_id' | 'description' | 'image' | 'title' | 'category' | 'price'>;
```

Данные товара, которые отображаются модальном окне корзины
```
export type TBasketInfo = Pick<IBasket, 'title' | 'price' | 'totalPrice'>;
```

Данные пользователя, которые  можно редактировать в модальном окне оформления заказа
```
export type TUserCheckout = Pick<IUser, 'payment' | 'address' | 'email' | 'phone'>;
```

Данные товара, которые отображаются в модальном окне успешного завершения заказа
```
export type TUserCheckoutComplieted = Pick<IBasket, 'totalPrice'>;
```

## Архитектура приложения

Код приложения WEB-ларёк разделен на:
- слой отображения (все что отвечает за вывод информации пользователю);
- слой данных (вся логика приложения без интерфейса);
- presenter (связывает данные и отобрадение);

### Базовый код

#### Класс API
Базовая логика запросов на сервер, в конструктор передается базовый адресс сервера и опциональный объект с загловком запроса.
Методы:
- POST - принимает объект с данными, обрабатывает и отправляет их как параметр при вызове метода;
- GET - отправляет запрос с данными и возвращает ответ сервера в виде промиса с объектом.

#### Класс EventEmitter
Брокер событий используется в presenter для обработки событий и в слоях приложения для генерации событий.
Методы:
- 'on' - установить обработчик на событие;
- 'emit' - инициализация события с данными;
- 'trigger' - колбэк-триггер, генерирующий событие при вызове;

### Слой данных

#### Класс CardsData
Класс отвечает за хранение и логику работы с данными карточек товаров.\
Конструктор принимает инстант брокера событий.\
В полях класса хранятся данные: 
- _id: string - уникальный идентификатор товара;
- _description: string - описание товара;
- _image: string - картонка товара;
- _title: string - название товара;
- _category: string - к какой категории относится товар;
- _price: number - цена товара;
- _cards: ICard[] - массив объектов карточек товаров;
- _preview: string | null - ID карточки товара, для просмотра в модальном окне;
- events: IEvents - экземпляр класса `EventEmitter` для инициализаций событий;
Класс содержит набор методов для взаимодействия с карточками товара:
- addBasket(cardId: string, payload: Function | null): void - добавляет выбранный товар в корзину. Если передан колбэк, то выполняет его после обновления, если нет, то вызывает событие изменения массива;
- deleteProduct(cardId: string, payload: Function | null): void - удаляет выбранный товар из корзины. Если передан колбэк, то выполняет его после обновления, если нет, то вызывает событие изменения массива;
- а так же сеттеры и геттеры для сохранения и получения данных из полей класса

#### Класс UserData
Класс отвечает за хранение и логику работы с данными пользователя.\
Конструктор принимает инстант брокера событий.\
В полях класса хранятся данные: 
- payment: boolean - выбор способа оплаты;
- address: string - адрес пользователя;
- email: string - электронная почта пользователя;
- phone: number - номер телефона пользователя;
Класс содержит набор методов для взаимодействия с данными пользователя:
- getUserInfo(): TUserCheckout - возврящает основные данные пользователя;
- setUserInfo(userData: IUser): void - сохраняет данные пользователя;
- checkValidation(data: Record<keyof TUserCheckout, boolean | string | number>): boolean - проверяет объект с данными пользователя на валидность;

#### Класс BasketData
Класс отвечает за хранение и логику работы с данными о корзите товаров.\
Конструктор принимает инстант брокера событий.\
В полях класса хранятся данные: 
- quantity: number - количество товаров в корзине;
- _title: string - название товара;
- _price: number - цена товара;
- totalPrice: number - общая стоимость товаров в корзине;
- cards: ICard[] - массив объектов карточек товаров;
- deleteProduct(cardId: string, payload: Function | null): void - удаляет выбранный товар из корзины. Если передан колбэк, то выполняет его после обновления, если нет, то вызывает событие изменения массива;

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элементн) передаваемых данных.

#### Класс Modal
реализует модальное окно. Так же предоставляет методы `open` и `close`для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по ESC, на клик в оверлей и на кнопку-крестик для закрытия попапаю
- constructor(selector: string, events: IEvents) - конструктор принимает селектор по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициализации событий.
Поля класса:
- modal: HTMLElement - элемент модального окна;
- events: IEvents - брокер событий;

#### Класс ModalWithCheckout
Расширяет класс Modal. Предназначен для реализации модального окна с формой содержей поля необходимые для заказа товра. При сабмите инициируется событие передавая в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Представляет методы для отображения ошибок и управления активностью кнопки сохранения.\
Поля класса:
- submitButton: HTMLBattonElement - кнопка формы для отправки данных пользователя;
- _form: HTMLFormElement - форма для оформления заказа;
- formName: string - значение атрибута name формы;
- button: NodeListOf<HTMLElement> - коллекция всех кнопок формы предназначенных для оформления заказа;
- inputs: NodeListOf<HTMLInputElement> - коллекция всех полей ввода формы;
- errors: Record<string, HTMLElement> - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов;

Методы:
- setValid(isValid: boolean): void - изменяет активность кнопки подтверждения
- getInputValues(): Record<string, string> - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- setInputValues(data: Record<string, string>): void - принимает объект с данными для заполнения полей формы
- setError(data: { field: string, value: string, validInformation: string }): void - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- showInputError (field: string, errorMessage: string): void - отображает полученный текст ошибки под указанным полем ввода
- hideInputError (field: string): void - очищает текст ошибки под указанным полем ввода
- close (): void - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- get form: HTMLElement - геттер для получения элемента формы

#### Класс ModalWithCard
Расширяет класс Modal. Предназначен для реализации модального окна товара. При сабмите инциируется событие передавая в него объект с данными о товаре. 
Поля класса:
- categoryElement: HTMLCategoryElement - элемент разметки с категорией товара;
- titleElement: HTMLTitleElement - элемент разметки с названием товара;
- descriptionElement: HTMLСategoryElement - элемент разметки с описанием товара;
- priceElement: HTMLDescriptionElement - элемент разметки с ценой товара;
- submitButton: HTMLBattonElement - кнопка для отправки данных о товаре;
- imageElement: HTMLImageElement - элемент разметки с изображением;

Методы:
- open(data: { _id: string, description: string, image: string, title: string, category: string, price: number }): void - расширение родительского метода, принимает данные о товаре, которые используются для заполнения атрибутов элементов модального окна.
- close(): void - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна.
- addBasket(data: { _id: string, title: string, price: number }): void - передает данные товара для добавления в корзину;
- deleteBasket(data: { _id: string, title: string, price: number }): void - передает данные товара для удаления товара из корзины, если он ранее уже был выбран;

#### Класс ModalWithBasket
Расширяет класс Modal. Предназначен для реализации модального окна корзины товаров. При сабмите инциируется событие передавая в него объект с данными о товаре.
Поля класса:
- quantityElement: HTMLQuantityElement - элемент разметки с числом товаров в корзине;
- titleElement: HTMLTitleElement - элемент разметки с названием товара;
- priceElement: HTMLPriceElement - элемент разметки с ценой товара;
- totalPriceElement: HTMLTotalPriceElement - элемент разметки с обзей стоимостью товаров в корзине;
- buttonDelete: NodeListOf<HTMLElement> - коллекция всех кнопок  предназначенных для удаления товра из корзины;
- buttonOrder: HTMLEButtonOrderElement - элемент разметки для перехода к оформлению товара;
Методы:
- open(data: { _id: string, description: string, image: string, title: string, category: string, price: number }): void - расширение родительского метода, принимает данные о товаре, которые используются для заполнения атрибутов элементов модального окна.
- close(): void - расширяет родительский метод, выполняя дополнительно очистку атрибутов модального окна.
- deleteBasket(data: { _id: string, title: string, price: number }): void - передает данные товара для удаления товара из корзины, если он ранее уже был выбран;

#### Класс ModalWithCheckoutComplieted
Расширяет класс Modal. Предназначен для реализации модального окна успешного офрмления заказа.
Поля класса:
- imageElement: HTMLImageElement - элемент разметки с изображением;
- titleElement: HTMLTitleElement - элемент разметки с названием товара;
- totalPriceElement: HTMLTotalPriceElement - элемент разметки с обзей 
- buttonCheckoutComplieted: HTMLEButtonCheckoutComplietedeElement - элемент разметки для перехода на главную страницу;

#### Класс Card
Отвечает за отображение карточки товара, задавая в карточке данные категории товара, названия, изображения, цену товара. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- setData(cardData: ICard): void - заполняет атрибуты элементов карточки данными, а так-же управляет отображением корзины удаления на основании данных о текущем пользователе.
- render(): HTMLElement - метод возвращает полностью заполненную карточку с установленными слушателями
- геттер id возвращает уникальный id карточки

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. Предоставляет метод `addCard(cardElement: HTMLElement)` для добавления карточек на страницу и сеттер `container` для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

### Описание событий

- `modal:open` - открытие модальных окон;
- `modal:close` - закрытие модальных окон;
- `card:add` - добавление товара в корзину;
- `card:delete` - удаление ранее выбранного товара из корзины;
- `basket:delete` - удаление ранее выбранного товара из корзины;
- `basket:submit` - сохранение выбранных товаров;
- `order:changed` - изменение данных в форме с данными пользователя;
- `order:validation` - событие, сообщающее о необходимости валидации формы данных пользователя;
- `order:complet` - событие, сообщающее об успешном оформлени заказа;
